# 查看数据库

```
show databases
show dbs  // 缩写
```

# 创建、切换和删除数据库

## 创建、切换

如果没有则默认会自动创建，但是创建的数据库还在内存中，因为没有集合，为空，所以默认不提交，隐藏了

```
use test
```

## 删除

- db：当前使用的数据库

```
db.dropDatabase()
```

# 创建和删除集合

db表示操作当前数据库     
集合相当于MySQL的表

## 创建

当创建了集合后数据库才会展示数据库，不然为空不会进行展示，这才是真正的数据库      
也可以不选择创建集合，在插入数据的时候指定自己需要的集合名称会自动创建

```
db.createCollection("table")
```

## 删除集合

如果数据库里面只有一个集合 那么这个集合删除之后 数据库就会被隐藏

- db：当前使用的数据库
- table：集合

```
db.table.drop()
```

# 插入数据

MongoDB使用的是类似python字典的方式来管理数据   
插入数据后默认会生成一个随机不重复的id，如果想要更改自己的不重复id则在插入的时候加上{'_id': 1}键

- db：当前数据库
- table：当前数据库的集合
- insertOne()：插入一条
- insertMany()：插入多条，使用[ ]框起来

```
// 单条
db.table.insertOne({'name': "小明"})

// 多条，使用[ ]框起来
db.table.insertMany([
    {'name': "小明", 'age': 18},
    {"name": "小红"}
])
```

# 查看数据

MongoDB使用的是类似python字典的方式来管理数据，所以查看的时候也使用python字典的方式

- db：当前数据库
- table：当前数据库的集合
- find()：查找的数据，不传入则返回全部数据，传入字典的方式则返回符合条件的
    - 第一个参数是字典形式，传入你需要查找的数据,{}表示全部（但通常没有第二参数的时候可以省略不写）
    - 第二个参数是字典形式，但是是针对于key的显示，键值为0表示不显示该键，1表示只显示除id以外的该键，0、1不能同时使用在一条语句上，要么只显示1的key，要么只隐藏0的key

```
db.table.find()

db.table.find({'name': '小明', 'age': 18})  // 多个条件就要同时满足两个条件才返回

db.table.find({}, {'age': 0})  // 隐藏指定key显示，{} 表示所有都查看（如果需要指定也可以传入键值对），{'age': 0} 表示隐藏指定key
db.table.find({'name': '小明'}, {'_id': 0})
```

# 替换数据

- db：当前数据库
- table：当前数据库的集合
- replaceOne()：只替换第一条找到的数据，第一个字典数据传入需要替换的源数据，第二个字典数据传入的是替换后的数据
- 替换全部：暂未提供该方法，利用其他语句代替

**！注意：替换的是全部字段数据，如果替换后的数据字段为空就为空**

```
db.table.replaceOne({'name': '小明'}, {'name': '消化', 'age' : 1111})  // 只是替换了 name 和 age ，如果有其他字段就为空了
```

# 嵌套存放字典数据

如果里面存放的数据还是字典形式可以使用`.`的方式来操作

```
// 使用查找来举例，不仅限于查找
db.table.find({"info.book": "西游记"})
``` 

# 运算符/操作符

**语法：{key} : {'操作符': 操作符比较的值}**

## 比较运算符

| 名称 | 符号  | 名称   | 符号   |
|----|-----|------|------|
| 等于 | $eq | 不等于  | $ne  |
| 大于 | $gt | 大于等于 | $gte |
| 小于 | $lt | 小于等于 | $lte |

```
// 使用查找来举例，不仅限于查找
db.table.find({"age": {"$gt": 19}})  // 大于19岁的
```

## 成员运算符

| 名称           | 符号   |
|--------------|------|
| 匹配任意满足条件的数据  | $in  |
| 匹配任意不满足条件的数据 | $nin |

```
// 使用查找来举例，不仅限于查找
db.table.find({"age": {"$in": [100,19]}})  // age的值在[100,19]里面都满足条件
```

## 逻辑连接符

| 名称             | 符号   |
|----------------|------|
| 匹配条件不成立的数据     | $not |
| 匹配条件全部成立的数据    | $and |
| 匹配至少一个条件成立的数据  | $or  |
| 匹配多个条件全部不成立的数据 | $nor |

```
// 使用查找来举例，不仅限于查找
db.table.find({"$and" : [{"name": "小明"}, {"age": {"$gte": 19}}]})  // 查找name=小明,并且age>=19的数据
```

## 字段操作符

| 名称              | 符号      |
|-----------------|---------|
| 查询包含某个字段的数据     | $exists |
| 查询指定字段包含指定类型的数据 | $type   |

```
// 如果需要取反可以使用$not，这里没有直接提供，所有可以结合其他操作符
db.table.find({"name": {"$exists": true}})  // 查询包含name字段的数据

db.table.find({"name": {"$type": "string"}})  // name字段类型为字符串的
```

## 数组操作符

**数据库集合里面的数据必须是数组[]才可以**

| 解释                        | 符号         |
|---------------------------|------------|
| 匹配数组中包含所有指定查询值的文档         | $all       |
| 匹配数组中至少有一个能完全匹配所有的查询条件的文档 | $elemMatch |

```
// 只返回 {"notes": "lomer","age": 1} 的相关数据
db.table.find({
    'info': {
        '$all': [{"notes": "lomer","age": 1}]
    }
})
```

```
// 返回 {"notes": "lomer"} 的全部相关的完整数据
db.table.find({
    'info': {
        '$elemMatch': {"notes": "lomer"}
    }
})
```

## 正则匹配

| 解释    | 符号            |
|-------|---------------|
| 正则匹配  | $regex        |
| 忽略大小写 | $options: "i" |

正则语法：^ 表示以什么开头

```
db.table.find({"name": {"$regex" : /^z/}})  // 匹配以z开头的name字段的信息，没有忽略大小写
db.table.find({"name": {"$regex" : /^z/, "$options": "i"}})  // 匹配以z开头的name字段信息，忽略大小写
```

# 分页查询

limit()可以和skip()一起使用,实现翻页效果

## 限制数据条数

返回前5条数据

```
db.table.find().limit(5)
```

## 数据跳步条数

返回第5条数据后面的数据

```
db.table.find().skip(5)
```

# 更新数据

如果字段存在就更新，如果字段不存在则创建字段然后写入你的更新值

- updateOne(): 更新数据函数。第一个参数是找的数据语句。第二个参数是更新的语句，需要结合$set来更新数据
- updateMany(): 更新所有的符合条件的，参数和updateOne()函数一样

```
db.table.updateOne({"name": "小明"}, {"$set": {"name":"小白", "age": 99}})  // 只更新第一条找到的数据
db.table.updateMany({"name": "小明"}, {"$set": {"name":"小白", "age": 99}})  // 更新全部
```

# 删除数据

- deleteOne(): 删除数据函数，只删除第一条找到的数据
- deleteMany(): 删除数据函数，删除全部找到的数据。如果里面不传入值，直接写{}则表示删除所有数据
- 有返回值：里面有删除的数据条数

```
db.table.deleteOne({"name": "小红"})  // 只是删除第一条找到的数据
db.table.deleteMany({"name": "小红"})  // 删除全部找到的数据
db.table.deleteMany({}) // 删除所有数据，里面没有值的约束
```